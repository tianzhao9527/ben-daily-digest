<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ben 的每日资讯简报</title>
<style>
:root { --bg:#f5f7fb; --card:#fff; --border:#e5e7eb; --text:#0f172a; --muted:#64748b; --pri:#2563eb; }
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
header{padding:16px 20px;font-weight:800;font-size:20px}
.layout{display:grid;grid-template-columns:260px 1fr 320px;gap:12px;padding:0 12px 12px}
.panel{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:12px;overflow:auto}
.left .btn{width:100%;margin-top:8px}
.btn{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;cursor:pointer}
.btn.primary{background:rgba(37,99,235,.1);border-color:rgba(37,99,235,.4);font-weight:700}
.section{margin-bottom:14px}
.card{border:1px solid var(--border);border-radius:12px;padding:10px;margin-bottom:8px;background:#fff}
.card h4{margin:0 0 6px 0;font-size:14px}
.card .meta{font-size:12px;color:var(--muted)}
/* overlay */
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:9999}
#overlay.open{display:flex}
#overlay .panel{width:min(820px,calc(100vw - 48px));max-height:80vh}
/* settings ui */
.sm-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.sm-card{border:1px solid var(--border);border-radius:14px;padding:12px;background:#fafafa}
.seg{padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#fff;cursor:pointer;font-size:12px}
.seg.active{background:rgba(37,99,235,.1);border-color:rgba(37,99,235,.4);font-weight:700}
.sm-row{display:flex;flex-wrap:wrap;gap:8px}
.sm-label{font-size:12px;font-weight:700;margin-bottom:8px}
footer{padding:12px;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>

<header>Ben 的每日资讯简报</header>

<div class="layout">
  <aside class="panel left">
    <button class="btn primary" id="btnSettings">设置</button>
    <button class="btn" id="btnTop">回到顶部</button>
  </aside>

  <main class="panel" id="main"></main>

  <aside class="panel right" id="right">
    <h4>右侧 KPI（示例）</h4>
    <div class="card">USD/CNY 7.00</div>
    <div class="card">美债10Y 4.18%</div>
  </aside>
</div>

<div id="overlay">
  <div class="panel">
    <h3>设置</h3>
    <div class="sm-grid">
      <div class="sm-card">
        <div class="sm-label">每板块展示条数</div>
        <div class="sm-row">
          <button class="seg" data-items="5">Top 5</button>
          <button class="seg" data-items="10">Top 10</button>
          <button class="seg" data-items="15">Top 15</button>
          <button class="seg" data-items="0">全部</button>
        </div>
      </div>
      <div class="sm-card">
        <div class="sm-label">是否显示右侧 KPI</div>
        <div class="sm-row">
          <button class="seg" data-kpi="on">显示</button>
          <button class="seg" data-kpi="off">隐藏</button>
        </div>
      </div>
    </div>
    <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px">
      <button class="btn" id="btnClose">关闭</button>
      <button class="btn primary" id="btnApply">应用</button>
    </div>
  </div>
</div>

<footer>本地设置保存在浏览器，不会影响生成端</footer>

<script>
/* ======= MOCK DIGEST (replace with generator output) ======= */
window.DIGEST = {
  sections:[
    {id:"macro",title:"宏观 / 市场",items:Array.from({length:15},(_,i)=>({t:"宏观新闻 "+(i+1)}))},
    {id:"sanctions",title:"制裁 / 合规",items:Array.from({length:12},(_,i)=>({t:"制裁新闻 "+(i+1)}))},
    {id:"ai",title:"AI / 算力",items:Array.from({length:20},(_,i)=>({t:"AI 新闻 "+(i+1)}))}
  ]
};

/* ======= SETTINGS ======= */
const LS_KEY="digest_settings";
const DEFAULT={itemsPerSection:5,showKPI:true};
let SETTINGS=JSON.parse(localStorage.getItem(LS_KEY)||JSON.stringify(DEFAULT));

function save(){localStorage.setItem(LS_KEY,JSON.stringify(SETTINGS));}
function apply(){
  renderMain();
  document.getElementById("right").style.display=SETTINGS.showKPI?"":"none";
}

/* ======= RENDER ======= */
function renderMain(){
  const main=document.getElementById("main");
  main.innerHTML="";
  DIGEST.sections.forEach(sec=>{
    const wrap=document.createElement("div");
    wrap.className="section";
    wrap.innerHTML=`<h3>${sec.title}</h3>`;
    const n=SETTINGS.itemsPerSection===0?sec.items.length:SETTINGS.itemsPerSection;
    sec.items.slice(0,n).forEach(it=>{
      const c=document.createElement("div");
      c.className="card";
      c.innerHTML=`<h4>${it.t}</h4>`;
      wrap.appendChild(c);
    });
    main.appendChild(wrap);
  });
}

/* ======= SETTINGS UI ======= */
const overlay=document.getElementById("overlay");
document.getElementById("btnSettings").onclick=()=>{
  overlay.classList.add("open");
  document.querySelectorAll("[data-items]").forEach(b=>{
    b.classList.toggle("active",Number(b.dataset.items)===SETTINGS.itemsPerSection);
    b.onclick=()=>{
      document.querySelectorAll("[data-items]").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      SETTINGS.itemsPerSection=Number(b.dataset.items);
    };
  });
  document.querySelectorAll("[data-kpi]").forEach(b=>{
    b.classList.toggle("active",(b.dataset.kpi==="on")===SETTINGS.showKPI);
    b.onclick=()=>{
      document.querySelectorAll("[data-kpi]").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      SETTINGS.showKPI=b.dataset.kpi==="on";
    };
  });
};
document.getElementById("btnApply").onclick=()=>{save();apply();overlay.classList.remove("open");};
document.getElementById("btnClose").onclick=()=>overlay.classList.remove("open");
document.getElementById("btnTop").onclick=()=>window.scrollTo({top:0,behavior:"smooth"});

/* init */
apply();
</script>

</body>
</html>
